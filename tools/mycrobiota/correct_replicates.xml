<tool id="mycrobiota-correct-replicates" name="Correct counts" version="0.1">
    <description>in a mothur shared file for replicates and negative controls</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <command detect_errors="aggressive"><![CDATA[
        python '$__tool_directory__/mycrobiota.py'
            --command correct_replicates
            --shared '$shared'
            --replicate_suffix '$replicate_suffix'
            #if $negative_control:
                --negative_control '$negative_control'
            #end if
    ]]></command>
    <inputs>
        <param argument="--shared" type="data" format="mothur.shared" label="Select shared file"/>
        <param argument="--replicate_suffix" type="text" size="100" value="_replicate" label="Suffix used to indicated replicates" help="e.g. _R if files are named [sample]_R1, [sample]_R2 etc"/>
        <param argument="--negative_control" type="text" optional="True" size="100" value="" label="sample name for your negative control (optional)" help="e.g. negative_control"/>
    </inputs>
    <outputs>
        <data name="corrected_out" format="mothur.shared" from_work_dir="shared_corrected.tsv" label="${tool.name} on ${on_string}"/>
    </outputs>
    <tests>
        <test><!-- test only dereplicating -->
            <param name="shared" value="shared_mock.tsv" ftype="mothur.shared"/>
            <param name="replicate_suffix" value="_replicate"/>
            <output name="corrected_out" file="shared_dereplicated.tsv" ftype="mothur.shared"/>
        </test>
        <test><!-- test with also negative control correction -->
            <param name="shared" value="shared_mock.tsv" ftype="mothur.shared"/>
            <param name="replicate_suffix" value="_replicate"/>
            <param name="negative_control" value="negative-control"/>
            <output name="corrected_out" md5="02848b930f6501e54f1dc812d0e13c66" ftype="mothur.shared"/>
        </test>
    </tests>
    <help><![CDATA[
**What it does**
averages the counts over all replicates of a sample in a mothur shared file
    ]]></help>
    <expand macro="citations"/>
</tool>
