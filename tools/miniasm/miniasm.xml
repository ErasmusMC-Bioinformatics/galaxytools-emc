<tool id="miniasm" name="Ultrafast de novo assembly for long noisy reads (though having no consensus step)" version="0.2.0">
	<requirements>
		<requirement type="package" version="0.2.0">miniasm</requirement>
	</requirements>
	<command detect_errors="exit_code"><![CDATA[
		miniasm
	    		-f '$readFile'
			#if '$settings.advanced' == "advanced"
				-m '$minMatch'
				-i '$minIden'
				-s '$minSpan'
				-c '$minCov'
				-o '$minOvlp'
				-h '$maxHang'
				-I '$intThres'
				-g '$maxGapDiff'
				-d '$maxBubDist'
				-e '$minUtgSize'
				-n '$nRounds'
				-F '$finalDropRatio'
			#end if
			'$paf' > '$gfa'
	]]></command>
	<inputs>
		<param type="data" name="readFile" format="fastq,fasta" optional="true"/>
		<param type="data" name="paf" format="interval" />
        <conditional name="settings">
            <param name="advanced" type="select" label="Specify advanced parameters">
                <option value="simple" selected="true">No, use program defaults.</option>
                <option value="advanced">Yes, see full parameter list.</option>
            </param>
            <when value="simple">
            </when>
            <when value="advanced">
            	<param name="minMatch" type="integer" value="100" optional="true" label="Drop  mappings  having  less  than INT matching bases (col10 in PAF) [100]. This option has the same role as -L of minimap." help=""/>
		<param name="minIden" type="float" value="0.05" optional="true" label="During  read  filtering,  ignore  mappings  with col10/col11 below FLOAT [0.05]. Ignored mappings are still used for read overlaps." help=""/>
		<param name="minSpan" type="integer" value="1000" optional="true" label="Drop mappings shorter than INT-bp [1000]. This option also  affects  the  second round of read filtering and minimal overlap length." help=""/>
		<param name="minCov" type="integer" value="3" optional="true" label="Minimal coverage by other reads [3]. In the first round  of  filtering,  miniasm finds  the  longest region covered by INT or more reads. In the second round, it in addition requires each remaining base to be covered by  INT  bases  at  least minSpan/2 from the ends of other reads." help=""/>
		<param name="minOvlp" type="integer" value="1000" optional="true" label="Minimal overlap length [same as minSpan]" help=""/>
		<param name="maxHang" type="integer" value="1000" optional="true" label="Maximum overhang length [1000]. An overhang is an unmapped region that should be mapped given a true overlap or true containment. If the overhang  is  too  long, the mapping is considered an internal match and will be ignored." help=""/>
		<param name="intThres" type="float" value="0.08" optional="true" label="Minimal  ratio  of  mapping  length  to  mapping+overhang  length  for a mapping considered a containment or an overlap [0.8]. This option has a similar role  to -h, except that it controls the ratio, not length." help=""/>
		<param name="maxGapDiff" type="integer" value="1000" optional="true" label="Maximal gap differences between two reads in a mapping [1000]. This parameter is only used for transitive reduction." help=""/>
		<param name="maxDubDist" type="integer" value="50000" optional="true" label="Maximal probing distance for bubble popping [50000].  Bubbles  longer  than  INT will not be popped." help=""/>
		<param name="minUtgSize" type="integer" value="4" optional="true" label="A  unitig  is  considered  small  if  it is composed of less than INT reads [4]. Miniasm may try to remove small unitigs at various steps." help=""/>
		<param name="nRounds" type="integer" value="3" optional="true" label="Rounds of short overlap removal [3]." help=""/>
		<param name="finalDropRatio" type="float" value="0.8" optional="true" label="Overlap drop ratio threshold after short unitig removal [0.8]." help=""/>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="gfa" format="txt" />
    </outputs>
    <tests>
        <test>
	     <param name="readFile" value="mini_reads.fq"/>
	     <param name="paf" value="mini_reads.paf.gz"/>
	     <output name="gfa" file="mini_reads.gfa"/>
	</test>
    </tests>
    <help><![CDATA[
        
Usage:   miniasm [options] <mapping.paf>|<output.gfa>
Options:
  Pre-selection:
    -m INT      min match length [100]
    -i FLOAT    min identity [0.05]
    -s INT      min span [2000]
    -c INT      min coverage [3]
  Overlap:
    -o INT      min overlap [same as -s]
    -h INT      max over hang length [1000]
    -I FLOAT    min end-to-end match ratio [0.8]
  Layout:
    -g INT      max gap differences between reads for trans-reduction [1000]
    -d INT      max distance for bubble popping [50000]
    -e INT      small unitig threshold [4]
    -f FILE     read sequences []
    -n INT      rounds of short overlap removal [3]
    -r FLOAT[,FLOAT]
                max and min overlap drop ratio [0.7,0.5]
    -F FLOAT    aggressive overlap drop ratio in the end [0.8]
  Miscellaneous:
    -p STR      output information: bed, paf, sg or ug [ug]
    -b          both directions of an arc are present in input
    -1          skip 1-pass read selection
    -2          skip 2-pass read selection
    -V          print version number

    ]]></help>
    <citations>
	    <citation type="doi">10.1093/bioinformatics/btw152</citation>
    </citations>
</tool>

